import { Board } from "../src/board";
import { StepManager } from "../src/stepManager";

describe("StepManager", () => {
    let stepManager;
    let board;
    beforeEach(() => {
        const height = 6;
        const width = 6;
        const xs = [
            [0, 1],
            [0, 2],
            [2, 0],
            [4, 1],
        ];
        const os = [
            [1, 5],
            [2, 3],
            [3, 1],
            [4, 4],
            [5, 4],
        ];
        board = new Board(width, height, xs, os);
        stepManager = new StepManager(board);
    });

    describe("create", () => {
        it("has a state object", () => {
            expect(stepManager.state).toEqual({
                consecutivePairs: {
                    checkEmpty: [],
                    columns: [],
                    currentPair: [],
                    currentType: "",
                    insertOpposite: [],
                    rows: [],
                },
                madeAChange: true,
            });
        });
    });

    describe("set up", () => {
        it("sets up the new state for the board", () => {
            stepManager.setUp();
            expect(stepManager.state).toEqual({
                consecutivePairs: {
                    checkEmpty: [],
                    columns: [
                        [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
                        [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
                        [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
                        [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
                        [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
                        [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
                    ],
                    currentPair: [],
                    currentType: "",
                    insertOpposite: [],
                    rows: [
                        [0, 1], [1, 2], [2, 3], [3, 4], [4, 5],
                        [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
                        [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
                        [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
                        [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
                        [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
                    ],
                },
                madeAChange: false,
            });
        });
    });

    it("step through concurrent pairs", () => {
        stepManager.setUp();
        expect(stepManager.state).toEqual({
            consecutivePairs: {
                checkEmpty: [],
                columns: [
                    [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
                    [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
                    [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
                    [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
                    [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
                    [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
                ],
                currentPair: [],
                currentType: "",
                insertOpposite: [],
                rows: [
                    [0, 1], [1, 2], [2, 3], [3, 4], [4, 5],
                    [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
                    [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
                    [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
                    [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
                    [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
                ],
            },
            madeAChange: false,
        });

        // moves to look at the current pair
        stepManager.takeStep();
        expect(stepManager.state).toEqual({
            consecutivePairs: {
                checkEmpty: [],
                columns: [
                    [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
                    [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
                    [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
                    [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
                    [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
                    [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
                ],
                currentPair: [0, 1],
                currentType: "row",
                insertOpposite: [],
                rows: [
                    [1, 2], [2, 3], [3, 4], [4, 5],
                    [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
                    [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
                    [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
                    [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
                    [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
                ],
            },
            madeAChange: false,
        });

        // remove current pair if they don't match
        stepManager.takeStep();
        expect(stepManager.state).toEqual({
            consecutivePairs: {
                checkEmpty: [],
                columns: [
                    [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
                    [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
                    [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
                    [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
                    [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
                    [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
                ],
                currentPair: [],
                currentType: "",
                insertOpposite: [],
                rows: [
                    [1, 2], [2, 3], [3, 4], [4, 5],
                    [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
                    [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
                    [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
                    [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
                    [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
                ],
            },
            madeAChange: false,
        });

        // move to looking at the next pair
        stepManager.takeStep();
        expect(stepManager.state).toEqual({
            consecutivePairs: {
                checkEmpty: [],
                columns: [
                    [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
                    [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
                    [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
                    [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
                    [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
                    [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
                ],
                currentPair: [1, 2],
                currentType: "row",
                insertOpposite: [],
                rows: [
                    [2, 3], [3, 4], [4, 5],
                    [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
                    [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
                    [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
                    [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
                    [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
                ],
            },
            madeAChange: false,
        });

        // move find the indexes that need to be checked
        stepManager.takeStep();
        expect(stepManager.state).toEqual({
            consecutivePairs: {
                checkEmpty: [0, 3],
                columns: [
                    [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
                    [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
                    [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
                    [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
                    [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
                    [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
                ],
                currentPair: [1, 2],
                currentType: "row",
                insertOpposite: [],
                rows: [
                    [2, 3], [3, 4], [4, 5],
                    [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
                    [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
                    [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
                    [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
                    [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
                ],
            },
            madeAChange: false,
        });

        // // move find the empty squares to insert
        // stepManager.takeStep();
        // expect(stepManager.state).toEqual({
        //     consecutivePairs: {
        //         checkEmpty: [0, 3],
        //         columns: [
        //             [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
        //             [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
        //             [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
        //             [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
        //             [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
        //             [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
        //         ],
        //         currentPair: [1, 2],
        //         currentType: "row",
        //         insertOpposite: [0, 3],
        //         rows: [
        //             [2, 3], [3, 4], [4, 5],
        //             [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
        //             [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
        //             [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
        //             [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
        //             [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
        //         ],
        //     },
        //     madeAChange: false,
        // });

        // // remove the data and insert into the board
        // stepManager.takeStep();
        // expect(stepManager.state).toEqual({
        //     consecutivePairs: {
        //         checkEmpty: [],
        //         columns: [
        //             [0, 6], [6, 12], [12, 18], [18, 24], [24, 30],
        //             [1, 7], [7, 13], [13, 19], [19, 25], [25, 31],
        //             [2, 8], [8, 14], [14, 20], [20, 26], [26, 32],
        //             [3, 9], [9, 15], [15, 21], [21, 27], [27, 33],
        //             [4, 10], [10, 16], [16, 22], [22, 28], [28, 34],
        //             [5, 11], [11, 17], [17, 23], [23, 29], [29, 35],
        //         ],
        //         currentPair: [],
        //         currentType: "",
        //         insertOpposite: [],
        //         rows: [
        //             [2, 3], [3, 4], [4, 5],
        //             [6, 7], [7, 8], [8, 9], [9, 10], [10, 11],
        //             [12, 13], [13, 14], [14, 15], [15, 16], [16, 17],
        //             [18, 19], [19, 20], [20, 21], [21, 22], [22, 23],
        //             [24, 25], [25, 26], [26, 27], [27, 28], [28, 29],
        //             [30, 31], [31, 32], [32, 33], [33, 34], [34, 35],
        //         ],
        //     },
        //     madeAChange: true,
        // });

        // needs the rest of the puzzle
        expect(true).toBeFalsy();
    });
});
